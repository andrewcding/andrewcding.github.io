<!DOCTYPE html>
<html lang="en">
<head>
	
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Andrew Ding</title>
	
	<link rel="preconnect" href="https://rsms.me/">
	<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
	
	<!-- Font Awesome-->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" />
	<script src="https://kit.fontawesome.com/baa8a15a0c.js" crossorigin="anonymous"></script>
	
	<!-- Mapbox-->
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
	
	<style>
		:root { font-family: 'Inter', sans-serif; }
		@supports (font-variation-settings: light) {
			:root { font-family: 'Inter var', sans-serif; }
		}
		
		body {
			background-color: #29292f;
			color: #e6e6e6;
		}
		
		.back_button {
			color: #949794;
			cursor: pointer;
			font-family: 'Inter';
			font-style: normal;
			font-weight: 300;
			font-size: 20px;
			line-height: 24px;
			background:none;
			border: none;
			outline: none;
			
			animation: fadeIn 1.4s; 
		}
		
		.back_button:hover {
			color: #e6e6e6;
		}
		
		.control_buttons {
			color: #949794;
			cursor: pointer;
			border: none;
			background: none;
			outline: none;
			
			animation: fadeIn 1.4s; 
		}
		
		.control_buttons:hover {
			color: #e6e6e6;
		}
		
		#btn-spin {
			background-color: #29292f;
			color: #949794;
			cursor: pointer;
			font-family: 'Inter';
			font-style: normal;
			font-weight: 300;
			font-size: 20px;
			line-height: 24px;
			border: none;
			outline: none;
			
			animation: fadeIn 1.4s; 
		}
		
		#btn-spin:hover {
			color: #e6e6e6;
		}
		
		#map { position: absolute; top: 0; bottom: 0; width: 99%; }
		
		.link { color: #e6e6e6; 
			text-decoration:none;
		} 
		
		.link:hover { color: #949794; 
		}
		
		.link2 { color: #e6e6e6; 
			text-decoration:none;
			line-height: 90px;
		} 
		
		.link2:hover { color: #949794; 
		}
		
		
		
		.alt_text { color: #949794; } 
		
		
		.text_up p {
			position: absolute;
			width: 100%;
			height: 100%;
			
			/* Apply animation to this element */	
			animation: text_up 1s ease-out; 
		}
		
		.text_up hr {
			position: absolute;
			width: 100%;
			height: 100%;
			
			/* Apply animation to this element */	
			animation: text_up 1s ease-out; 
		}
		
		.text_down p {
			position: absolute;
			width: 100%;
			height: 100%;
			
			/* Apply animation to this element */	
			animation: text_down 1s ease-out; 
		}
		
		.text_down i {
			position: absolute;
			width: 100%;
			height: 100%;
			
			/* Apply animation to this element */	
			animation: text_down 1s ease-out; 
		}
		
		/* Move it (define the animation) */
		@keyframes text_up {
			0%   { 
				transform: translateY(50%); 		
			}
			100% { 
				transform: translateY(0%); 
			}
		}
		
		/* Move it (define the animation) */
		@keyframes text_down {
			0%   { 
				transform: translateY(-100%); 		
			}
			100% { 
				transform: translateY(0%); 
			}
		}
		
		.fade-in-text { animation: fadeIn 1.4s; }
		
		@keyframes fadeIn {
			0% { opacity: 0.00; }
			20% { opacity: 0.02; }
			100% { opacity: 1; }
		}
		
		.map_label{
			font-family: "Inter";
			font-style: normal;
			color: #29292f;
			font-weight: 450;
			font-size: 19px;
		}
		
		.map_label2{
			font-family: "Inter";
			font-style: normal;
			color: #29292f;
			font-weight: 450;
			font-size: 14px;
		}
		
		.tooltip-inner {
			background-color: #29292f;
			opacity: 1 !important;
			padding: 10px;
		}
		
	</style>
	
</head>
<body>
	<main>
		<div id="map"></div>
		
		<a href="./" class="link">
			<div class ='text_down fade-in-text'>
				<p style="position: absolute;
				width: 186px;
				height: 76px;
				left: 38px;
				top: 5px;
				
				font-family: 'Inter';
				font-style: normal;
				font-weight: 300;
				font-size: 20px;
				line-height: 24px;"
				>Andrew<br>Ding.</p>
				
			</div>
		</a>
		
		<div class ='text_down fade-in-text'>
			<a class="link" href="https://www.linkedin.com/in/andrewcding/" target="_blank"><i class="fa-brands fa-linkedin fa-lg"  
				style="position: absolute;
				width: 15px;
				height: 15px;
				right: 50px;
				top: 40px;"></i>
			</a>
			
			<a class="link" href="mailto:a8ding@uwaterloo.ca"><i class="fa-solid fa-envelope fa-lg"  
				style="position: absolute;
				width: 15px;
				height: 15px;
				right: 90px;
				top: 40px;"></i>
			</a>
			
		</div>
		
		
		
		<button style = 'position: absolute;
		left: 15px;
		bottom: 35px;
		font-weight: 200;
		font-size: 20px;
		' class = 'back_button'
		onclick="location.href='./maps'">
		← </button> 
		
		<button style = 'position: absolute;
		right: 120px;
		bottom: 20px;
		font-weight: 250;
		font-size: 16px;
		' class = 'control_buttons'
		onclick="zoom = map.getZoom(); zoom = zoom += 1; map.flyTo({zoom: zoom});">
		<i class="fa fa-magnifying-glass-plus"></i></button> 
		
		<button style = 'position: absolute;
		right: 95px;
		bottom: 20px;
		font-weight: 250;
		font-size: 16px;
		' class = 'control_buttons'
		onclick="zoom = map.getZoom(); zoom = zoom -= 1; map.flyTo({zoom: zoom});">
		<i class="fa fa-magnifying-glass-minus"></i></button> 
		
		<button style = 'position: absolute;
		right: 70px;
		bottom: 20px;
		font-weight: 250;
		font-size: 16px;
		' class = 'control_buttons'
		onclick="spinEnabled = true; spinGlobe(); ">
		<i class="fa fa-play"></i></button> 
		
		<button style = 'position: absolute;
		right: 45px;
		bottom: 20px;
		font-weight: 250;
		font-size: 16px;
		' class = 'control_buttons'
		onclick="spinEnabled = false; spinGlobe();">
		<i class="fa fa-pause"></i></button> 

		<button style = 'position: absolute;
		right: 20px;
		bottom: 20px;
		font-weight: 250;
		font-size: 16px;
		' class = 'control_buttons'
		data-toggle="tooltip" data-html="true" data-placement = "left" title="<b>Map Information:</b><br>
		<p>Welcome to my travel map! This map shows all the places I have visited.
			<br> The ✦ symbol denotes places I have lived in. 
			<br>
			<br> Pause the rotation by pressing space or clicking the pause button. 
			<br> Alternatively, the rotation will automatically be paused past a certain zoom.
			<br> Use the scroll wheel or the zoom buttons to zoom in and out of the map. 
			<br> For more info on a point or country, hover over it.</p>">
		<i class="fa-solid fa-question"></i></button> 
		
		
	</main>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
	integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
	crossorigin="anonymous"></script>

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
	integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
	crossorigin="anonymous"></script>


	<script>

$(document).ready(function(){
				$('[data-toggle="tooltip"]').tooltip();   

				$('button').tooltip().mouseover();
				$("main").mousedown(function () {
          			$('[data-toggle="tooltip"]').tooltip("hide");
       			});
			});

		mapboxgl.accessToken = 'pk.eyJ1IjoiYW5kd29vIiwiYSI6ImNrMjlnYnNkdTEwMHozaG5wamJvZHJyangifQ.6M4eeri_Ubmo7NedQT7NuQ';
		
		var zoom = 2;
		const map = new mapboxgl.Map({
			container: 'map', // container ID
			// Choose from Mapbox's core styles, or make your own style with Mapbox Studio
			style: 'mapbox://styles/andwoo/clfyuy060000701p957fa8iwz', // style URL w labels( mapbox://styles/mapbox/light-v11)
			center: [0, 20], // starting position [lng, lat]
			zoom: zoom, // starting zoom
			attributionControl: false,
			maxZoom: 6,
			minZoom: 0
			
		});
		
		
		map.on('style.load', () => {
			map.setFog({
				color: 'rgb(186, 210, 235)', // Lower atmosphere
				'high-color': '#29292f', // Upper atmosphere
				'horizon-blend': 0.02, // Atmosphere thickness (default 0.2 at low zooms)
				'space-color': '#29292f', // Background color
				'star-intensity': 0. // Background star brightness (default 0.35 at low zoooms )
			});
		});
		
		map.on('load', async () => {
			
			// COUNTRIES -----------------------------------
			map.addSource("countries_source", {
				"type": "geojson",
				"data": "https://andrewding.ca/jsons/Countries_Visited.geojson"
			});
			
			map.addLayer(
			{
				'id': 'countries-fill',
				'type': 'fill',
				'source': 'countries_source',
				'layout': {
					'visibility': 'visible'
				},
				'paint': {
					'fill-color' : ['match', ['get', 'Visited'], // get the property
					0, '#e6e6e6',              
					1, '#d6c8ae',              
					'black'] ,
					"fill-opacity": ["case",
					["boolean", ["feature-state", "hover"], false],
					0.6,
					1
					] 
				}         
			});
			
			map.addLayer({
				'id': 'countries-border',
				'type': 'line',	
				'source': 'countries_source',
				'layout': {
					'visibility': 'visible'
				},
				'paint': {
					'line-color': '#FFFFFF',
					'line-width': [
					'interpolate', 
					['linear'], 
					['zoom'],
					10, 0.4, 
					19, 1
					]
				}
			});
			
			// PLACES -----------------------------------
			
			map.addSource("places_source", {
				"type": "geojson",
				"data": "https://andrewding.ca/jsons/Places_Visited.geojson"
			});
			
			map.addLayer({
				'id': 'places_point',
				'type': 'circle',	
				'source': 'places_source',
				'layout': {
					'visibility': 'visible'
				},
				'paint': {
					'circle-color': '#736854',
					'circle-radius': 2
				}
			});

			// this layer makes it easier to hover over a point, by making an invisible point with larger radius
			map.addLayer({
				'id': 'places_visited',
				'type': 'circle',	
				'source': 'places_source',
				'layout': {
					'visibility': 'visible'
				},
				'paint': {
					// if lived, make it match background colour (colour of country) to hide popup
					'circle-color': ['match', ['get', 'Lived'], // get the property
					0, '#736854',              
					1, '#d6c8ae',              
					'#736854'],
					'circle-radius': ["case",
					["boolean", ["feature-state", "hover"], false],
					8,
					8
					],
					'circle-opacity': ["case",
					["boolean", ["feature-state", "hover"], false],
					1,
					0
					]  
				}
			});
			
			map.addLayer({
				'id': 'places_lived',
				'type': 'symbol',	
				'source': 'places_source',
				'layout': {
					'visibility': 'visible',
					'text-field': '✦',
					'text-size': 12
				},
				'paint': {
					'text-color': '#fff',
					'text-halo-color': '#000',
					'text-halo-width': 0.5
				}
			});
			
			map.setFilter('places_lived', ['==', ['get', 'Lived'], 1]);
			
		});
		
		// The following values can be changed to control rotation speed:
		
		// At low zooms, complete a revolution every two minutes.
		const secondsPerRevolution = 60;
		// Above zoom level 8, do not rotate.
		const maxSpinZoom = 5;
		// Rotate at intermediate speeds between zoom levels 3 and 5.
		const slowSpinZoom = 2;
		
		let userInteracting = false;
		let spinEnabled = true;
		
		function spinGlobe() {
			const zoom = map.getZoom();
			if (spinEnabled && !userInteracting && zoom < maxSpinZoom) {
				let distancePerSecond = 360 / secondsPerRevolution;
				if (zoom > slowSpinZoom) {
					// Slow spinning at higher zooms
					const zoomDif =
					(maxSpinZoom - zoom) / (maxSpinZoom - slowSpinZoom);
					distancePerSecond *= zoomDif*0.8;
				}
				const center = map.getCenter();
				center.lng -= distancePerSecond;
				// Smoothly animate the map over one second.
				// When this animation is complete, it calls a 'moveend' event.
				map.easeTo({ center, duration: 1000, easing: (n) => n });
			}
		}
		
		function resumeSpin() {
			userInteracting = false;
			spinGlobe();
		}
		
		document.body.onkeyup = function(e) {
			if (e.key == " " ||
			e.code == "Space" ||      
			e.keyCode == 32      
			) {

				if(spinEnabled){
					spinEnabled = false;
					spinGlobe();
				} else {
					spinEnabled = true;
					resumeSpin()	
				}
			}
		}
		
		// Pause spinning on interaction
		map.on('mousedown', () => {
			userInteracting = true;
		});
		
		map.on('wheel', (e) => {
			userInteracting = true;
			setTimeout(resumeSpin, 200);
		});

		map.on('touchmove', (e) => {
    		userInteracting = true;
    		setTimeout(resumeSpin, 200);
		});
		
		// Restart spinning the globe when interaction is complete
		map.on('mouseup', () => {
			userInteracting = false;
			spinGlobe();
		});
		
		// These events account for cases where the mouse has moved
		// off the map, so 'mouseup' will not be fired.
		map.on('dragend', () => {
			userInteracting = false;
			spinGlobe();
		});
		map.on('pitchend', () => {
			userInteracting = false;
			spinGlobe();
		});
		map.on('rotateend', () => {
			userInteracting = false;
			spinGlobe();
		});
		
		// When animation is complete, start spinning if there is no ongoing interaction
		map.on('moveend', () => {
			spinGlobe();
		});
		
		spinGlobe();
		
		// popups
		
		var popup = new mapboxgl.Popup({
			closeButton: false,
			closeOnClick: false
		});
		
		var hoveredStateId = null;
		var hoveredStateId2 = null;
		
		
		map.on('mousemove', 'countries-fill', function (e) {

				map.getCanvas().style.cursor = "pointer";
				
				var coordinates = e.features[0].geometry.coordinates.slice();
				var country_name = e.features[0].properties.COUNTRY;
				
				// Populate the popup and set its coordinates
				// based on the feature found.
				popup.setLngLat(e.lngLat).setHTML(
				"<span class = 'map_label'>"+country_name+"</span>").addTo(map);
				
				
				if (hoveredStateId) {
					map.setFeatureState({
						source: 'countries_source',
						id: hoveredStateId
					}, {
						hover: false
					});
				}
				hoveredStateId = e.features[0].id;
				map.setFeatureState({
					source: 'countries_source',
					id: hoveredStateId
				}, {
					hover: true
				});
				
			
		});
		
		
		map.on('mouseleave', 'countries-fill', function () {

				map.getCanvas().style.cursor = '';
				if (hoveredStateId) {
					map.setFeatureState({
						source: 'countries_source',
						id: hoveredStateId
					}, {
						hover: false
					});
				}
				hoveredStateId = null;
				popup.remove();

		});
		
		
		map.on('mousemove', 'places_visited', function (e) {

				map.getCanvas().style.cursor = "pointer";
				
				var coordinates = e.features[0].geometry.coordinates.slice();
				var place_name = e.features[0].properties.PlaceName;
				var country_name = e.features[0].properties.Country;
				
				// Populate the popup and set its coordinates
				// based on the feature found.
				popup.setLngLat(e.lngLat).setHTML(
				"<b class = 'map_label2'>"+place_name+', ' + country_name + "</b>").addTo(map);
				
				if (hoveredStateId2) {
					map.setFeatureState({
						source: 'places_source',
						id: hoveredStateId2
					}, {
						hover: false
					});
				}
				hoveredStateId2 = e.features[0].id;
				map.setFeatureState({
					source: 'places_source',
					id: hoveredStateId2
				}, {
					hover: true
				});
			
			
		});
		
		map.on('mouseleave', 'places_visited', function () {

				map.getCanvas().style.cursor = '';
				if (hoveredStateId2) {
					map.setFeatureState({
						source: 'places_source',
						id: hoveredStateId2
					}, {
						hover: false
					});
				}
				hoveredStateId2 = null;
				popup.remove();
			
		});
		
		
		
		
	</script>
</body>
</html>
